services:
  emby-stats:
    build: .
    container_name: emby-stats
    restart: unless-stopped
    ports:
      - "8899:8000"
    volumes:
      # Emby数据库文件挂载（只读，用于读取播放记录）
      - /path/to/emby/data/playback_reporting.db:/emby-data/playback_reporting.db:ro
      - /path/to/emby/data/users.db:/emby-data/users.db:ro
      - /path/to/emby/data/authentication.db:/emby-data/authentication.db:ro
      # Webhook配置目录（可写，用于保存webhook通知配置）
      - emby-stats-data:/data
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      # 播放记录插件数据库路径（容器内路径）
      - PLAYBACK_DB=/emby-data/playback_reporting.db
      # 用户数据库路径（容器内路径）
      - USERS_DB=/emby-data/users.db
      # 认证数据库路径（容器内路径，用于自动获取 API Key）
      - AUTH_DB=/emby-data/authentication.db
      # Emby 服务器地址
      - EMBY_URL=http://your-emby-server:8096
      # Emby API Key（可选，不填则自动从数据库获取）
      - EMBY_API_KEY=
      # 最小播放时长过滤（秒），低于此时长的记录不计入播放次数，0 或不填表示不过滤
      # - MIN_PLAY_DURATION=300
      # 时区偏移（小时），用于 SQLite 查询时间转换，上海为 +8，默认 8
      # - TZ_OFFSET=8

volumes:
  # 数据卷用于持久化webhook配置
  emby-stats-data:
