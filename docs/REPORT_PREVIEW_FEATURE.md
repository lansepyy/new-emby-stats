# 观影报告预览功能

## 功能说明

在观影报告推送配置页面添加了**报告预览**功能，用户在发送报告前可以提前查看报告的样式和内容。

## 主要特性

### 1. 预览按钮
- 每个报告类型（每日/每周/每月）都有独立的"预览"按钮
- 位置：在"立即发送"按钮旁边
- 图标：眼睛图标 👁️

### 2. 预览弹窗
- **美观的全屏弹窗**：使用半透明黑色背景
- **响应式设计**：自适应不同屏幕尺寸
- **高清预览**：2倍分辨率，确保清晰度
- **滚动支持**：内容过长时可滚动查看

### 3. 弹窗功能
- **标题显示**：明确显示是哪种类型的报告（每日/每周/每月）
- **加载状态**：生成预览时显示加载动画
- **快速操作**：
  - "关闭"按钮：关闭预览
  - "发送此报告"按钮：确认后直接发送
- **点击背景关闭**：点击弹窗外部区域可关闭

## 使用流程

1. 进入 **通知与推送 > 观影报告** 页面
2. 配置好报告推送设置（启用报告、选择推送渠道等）
3. 点击任一报告类型的 **"预览"** 按钮
4. 等待预览生成（通常 1-3 秒）
5. 查看预览效果：
   - 检查标题、日期是否正确
   - 查看统计数据（时长、次数、内容数）
   - 确认热门内容列表和封面图片
6. 满意后可直接点击"发送此报告"，或关闭预览窗口

## 技术实现

### 前端
- 使用 `html2canvas` 库将 React 组件转换为图片
- 2倍分辨率渲染确保清晰度
- 异步加载封面图片
- 自动清理资源（blob URLs、DOM 元素）

### 数据获取
- 调用 `/api/report/generate?type={type}` 获取报告数据
- 自动获取热门内容的封面图片（110×155 尺寸）
- 复用 `ReportImage` 组件确保与实际发送一致

## 界面改进

### 按钮布局
```
[推送时间] [预览] [立即发送]
```

- **预览按钮**：灰色背景，眼睛图标
- **立即发送按钮**：主题色背景，醒目

### 预览弹窗布局
```
┌────────────────────────────────────┐
│ 每日报告预览              [×]      │
│ 这是将要发送的报告效果              │
├────────────────────────────────────┤
│                                    │
│         [报告图片预览]             │
│                                    │
│         (可滚动查看)               │
│                                    │
├────────────────────────────────────┤
│ 💡 提示信息      [关闭] [发送此报告]│
└────────────────────────────────────┘
```

## 注意事项

1. **预览与实际发送的差异**
   - 预览使用前端渲染（html2canvas）
   - 定时推送使用后端生成（PIL 或 Playwright）
   - 两者样式基本一致，但可能有细微差异

2. **性能考虑**
   - 预览生成需要下载封面图片，可能需要几秒钟
   - 生成过程中禁用预览按钮，防止重复点击
   - 自动清理临时资源，不占用内存

3. **错误处理**
   - 如果预览生成失败，会显示错误提示
   - 用户仍可直接使用"立即发送"功能

## 优势

✅ **可视化**：发送前看到真实效果
✅ **安心**：确认数据准确无误
✅ **便捷**：预览后可直接发送
✅ **高效**：复用现有组件，代码简洁

## 未来优化

- [ ] 支持保存预览图片到本地
- [ ] 支持多种报告样式切换预览
- [ ] 添加预览缓存，避免重复生成
- [ ] 支持预览历史报告
